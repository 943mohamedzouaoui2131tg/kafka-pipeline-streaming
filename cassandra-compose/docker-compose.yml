version: "3.8"

services:
    cassandra1:
        image: cassandra:3.0
        container_name: cassandra1
        hostname: cassandra1
        ports:
            - "3000:9042"
            - "7000:7000"
        environment:
            - CASSANDRA_CLUSTER_NAME=ProjetCluster
            - CASSANDRA_DC=datacenter1
            - CASSANDRA_RACK=rack1
            - CASSANDRA_ENDPOINT_SNITCH=GossipingPropertyFileSnitch
            - CASSANDRA_SEEDS=cassandra1
            - MAX_HEAP_SIZE=512M
            - HEAP_NEWSIZE=100M
        volumes:
            - cassandra1_data:/var/lib/cassandra
        networks:
            - cassandra-network
        healthcheck:
            test: ["CMD-SHELL", "cqlsh -e 'describe cluster' || exit 1"]
            interval: 30s
            timeout: 10s
            retries: 10
            start_period: 90s
        restart: unless-stopped

    cassandra2:
        image: cassandra:3.0
        container_name: cassandra2
        hostname: cassandra2
        ports:
            - "9043:9042"
        environment:
            - CASSANDRA_CLUSTER_NAME=ProjetCluster
            - CASSANDRA_DC=datacenter1
            - CASSANDRA_RACK=rack1
            - CASSANDRA_ENDPOINT_SNITCH=GossipingPropertyFileSnitch
            - CASSANDRA_SEEDS=cassandra1
            - MAX_HEAP_SIZE=512M
            - HEAP_NEWSIZE=100M
        volumes:
            - cassandra2_data:/var/lib/cassandra
        networks:
            - cassandra-network
        depends_on:
            cassandra1:
                condition: service_healthy
        healthcheck:
            test: ["CMD-SHELL", "cqlsh -e 'describe cluster' || exit 1"]
            interval: 30s
            timeout: 10s
            retries: 10
            start_period: 90s
        restart: unless-stopped

    cassandra3:
        image: cassandra:3.0
        container_name: cassandra3
        hostname: cassandra3
        ports:
            - "9044:9042"
        environment:
            - CASSANDRA_CLUSTER_NAME=ProjetCluster
            - CASSANDRA_DC=datacenter1
            - CASSANDRA_RACK=rack1
            - CASSANDRA_ENDPOINT_SNITCH=GossipingPropertyFileSnitch
            - CASSANDRA_SEEDS=cassandra1
            - MAX_HEAP_SIZE=512M
            - HEAP_NEWSIZE=100M
        volumes:
            - cassandra3_data:/var/lib/cassandra
        networks:
            - cassandra-network
        depends_on:
            cassandra2:
                condition: service_healthy
        healthcheck:
            test: ["CMD-SHELL", "cqlsh -e 'describe cluster' || exit 1"]
            interval: 30s
            timeout: 10s
            retries: 10
            start_period: 90s
        restart: unless-stopped

networks:
    cassandra-network:
        driver: bridge

volumes:
    cassandra1_data:
    cassandra2_data:
    cassandra3_data: